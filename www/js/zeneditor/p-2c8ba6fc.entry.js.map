{"version":3,"names":["FloatingMenuView","constructor","editor","element","view","tippyOptions","shouldShow","this","preventHide","state","selection","$anchor","empty","isRootDepth","depth","isEmptyTextBlock","parent","isTextblock","type","spec","code","textContent","hasFocus","isEditable","mousedownHandler","focusHandler","setTimeout","update","blurHandler","event","_a","relatedTarget","parentNode","contains","hide","tippyBlurHandler","addEventListener","capture","on","remove","style","visibility","createTooltip","editorElement","options","editorIsAttached","parentElement","tippy","duration","getReferenceClientRect","content","interactive","trigger","placement","hideOnClick","popper","firstChild","oldState","_b","_c","doc","from","to","isSame","eq","call","setProps","posToDOMRect","show","destroy","removeEventListener","off","FloatingMenuPlugin","Plugin","key","pluginKey","PluginKey","Extension","create","name","addOptions","addProseMirrorPlugins","tiptapFloatingMenuCss","FloatingMenu","componentDidLoad","Boolean","isDestroyed","menuProps","plugin","Object","assign","anchor","pos","parentOffset","registerPlugin","render","items","icon","title","action","h","ref","el","class","map","item","index","isHidden","rest","__rest","itemProps"],"sources":["./node_modules/@tiptap/extension-floating-menu/dist/index.js","./src/components/tiptap-floating-menu/tiptap-floating-menu.scss?tag=tiptap-floating-menu","./src/components/tiptap-floating-menu/tiptap-floating-menu.tsx"],"sourcesContent":["import { posToDOMRect, Extension } from '@tiptap/core';\nimport { Plugin, PluginKey } from '@tiptap/pm/state';\nimport tippy from 'tippy.js';\n\nclass FloatingMenuView {\r\n    constructor({ editor, element, view, tippyOptions = {}, shouldShow, }) {\r\n        this.preventHide = false;\r\n        this.shouldShow = ({ view, state }) => {\r\n            const { selection } = state;\r\n            const { $anchor, empty } = selection;\r\n            const isRootDepth = $anchor.depth === 1;\r\n            const isEmptyTextBlock = $anchor.parent.isTextblock && !$anchor.parent.type.spec.code && !$anchor.parent.textContent;\r\n            if (!view.hasFocus()\r\n                || !empty\r\n                || !isRootDepth\r\n                || !isEmptyTextBlock\r\n                || !this.editor.isEditable) {\r\n                return false;\r\n            }\r\n            return true;\r\n        };\r\n        this.mousedownHandler = () => {\r\n            this.preventHide = true;\r\n        };\r\n        this.focusHandler = () => {\r\n            // we use `setTimeout` to make sure `selection` is already updated\r\n            setTimeout(() => this.update(this.editor.view));\r\n        };\r\n        this.blurHandler = ({ event }) => {\r\n            var _a;\r\n            if (this.preventHide) {\r\n                this.preventHide = false;\r\n                return;\r\n            }\r\n            if ((event === null || event === void 0 ? void 0 : event.relatedTarget) && ((_a = this.element.parentNode) === null || _a === void 0 ? void 0 : _a.contains(event.relatedTarget))) {\r\n                return;\r\n            }\r\n            this.hide();\r\n        };\r\n        this.tippyBlurHandler = (event) => {\r\n            this.blurHandler({ event });\r\n        };\r\n        this.editor = editor;\r\n        this.element = element;\r\n        this.view = view;\r\n        if (shouldShow) {\r\n            this.shouldShow = shouldShow;\r\n        }\r\n        this.element.addEventListener('mousedown', this.mousedownHandler, { capture: true });\r\n        this.editor.on('focus', this.focusHandler);\r\n        this.editor.on('blur', this.blurHandler);\r\n        this.tippyOptions = tippyOptions;\r\n        // Detaches menu content from its current parent\r\n        this.element.remove();\r\n        this.element.style.visibility = 'visible';\r\n    }\r\n    createTooltip() {\r\n        const { element: editorElement } = this.editor.options;\r\n        const editorIsAttached = !!editorElement.parentElement;\r\n        if (this.tippy || !editorIsAttached) {\r\n            return;\r\n        }\r\n        this.tippy = tippy(editorElement, {\r\n            duration: 0,\r\n            getReferenceClientRect: null,\r\n            content: this.element,\r\n            interactive: true,\r\n            trigger: 'manual',\r\n            placement: 'right',\r\n            hideOnClick: 'toggle',\r\n            ...this.tippyOptions,\r\n        });\r\n        // maybe we have to hide tippy on its own blur event as well\r\n        if (this.tippy.popper.firstChild) {\r\n            this.tippy.popper.firstChild.addEventListener('blur', this.tippyBlurHandler);\r\n        }\r\n    }\r\n    update(view, oldState) {\r\n        var _a, _b, _c;\r\n        const { state } = view;\r\n        const { doc, selection } = state;\r\n        const { from, to } = selection;\r\n        const isSame = oldState && oldState.doc.eq(doc) && oldState.selection.eq(selection);\r\n        if (isSame) {\r\n            return;\r\n        }\r\n        this.createTooltip();\r\n        const shouldShow = (_a = this.shouldShow) === null || _a === void 0 ? void 0 : _a.call(this, {\r\n            editor: this.editor,\r\n            view,\r\n            state,\r\n            oldState,\r\n        });\r\n        if (!shouldShow) {\r\n            this.hide();\r\n            return;\r\n        }\r\n        (_b = this.tippy) === null || _b === void 0 ? void 0 : _b.setProps({\r\n            getReferenceClientRect: ((_c = this.tippyOptions) === null || _c === void 0 ? void 0 : _c.getReferenceClientRect) || (() => posToDOMRect(view, from, to)),\r\n        });\r\n        this.show();\r\n    }\r\n    show() {\r\n        var _a;\r\n        (_a = this.tippy) === null || _a === void 0 ? void 0 : _a.show();\r\n    }\r\n    hide() {\r\n        var _a;\r\n        (_a = this.tippy) === null || _a === void 0 ? void 0 : _a.hide();\r\n    }\r\n    destroy() {\r\n        var _a, _b;\r\n        if ((_a = this.tippy) === null || _a === void 0 ? void 0 : _a.popper.firstChild) {\r\n            this.tippy.popper.firstChild.removeEventListener('blur', this.tippyBlurHandler);\r\n        }\r\n        (_b = this.tippy) === null || _b === void 0 ? void 0 : _b.destroy();\r\n        this.element.removeEventListener('mousedown', this.mousedownHandler, { capture: true });\r\n        this.editor.off('focus', this.focusHandler);\r\n        this.editor.off('blur', this.blurHandler);\r\n    }\r\n}\r\nconst FloatingMenuPlugin = (options) => {\r\n    return new Plugin({\r\n        key: typeof options.pluginKey === 'string' ? new PluginKey(options.pluginKey) : options.pluginKey,\r\n        view: view => new FloatingMenuView({ view, ...options }),\r\n    });\r\n};\n\nconst FloatingMenu = Extension.create({\r\n    name: 'floatingMenu',\r\n    addOptions() {\r\n        return {\r\n            element: null,\r\n            tippyOptions: {},\r\n            pluginKey: 'floatingMenu',\r\n            shouldShow: null,\r\n        };\r\n    },\r\n    addProseMirrorPlugins() {\r\n        if (!this.options.element) {\r\n            return [];\r\n        }\r\n        return [\r\n            FloatingMenuPlugin({\r\n                pluginKey: this.options.pluginKey,\r\n                editor: this.editor,\r\n                element: this.options.element,\r\n                tippyOptions: this.options.tippyOptions,\r\n                shouldShow: this.options.shouldShow,\r\n            }),\r\n        ];\r\n    },\r\n});\n\nexport { FloatingMenu, FloatingMenuPlugin, FloatingMenuView, FloatingMenu as default };\n//# sourceMappingURL=index.js.map\n",null,"import { Component, State, Prop, h } from '@stencil/core';\nimport { FloatingMenuPlugin, FloatingMenuPluginProps } from '@tiptap/extension-floating-menu';\nimport { posToDOMRect } from '@tiptap/core';\nimport { Editor } from '../../editor';\n\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\nexport type FloatingMenuProps = Omit<Optional<FloatingMenuPluginProps, 'pluginKey' | 'editor'>, 'element'>;\n\n@Component({\n  tag: 'tiptap-floating-menu',\n  styleUrl: 'tiptap-floating-menu.scss',\n})\nexport class FloatingMenu {\n  /**\n   * Floating menu props.\n   */\n  @Prop() menuProps: FloatingMenuProps;\n\n  /**\n   * Tiptap editor instance.\n   */\n  @Prop() editor: Editor;\n  @State() element: HTMLDivElement;\n\n  componentDidLoad() {\n    if (!Boolean(this.element) || this.editor.isDestroyed) {\n      return;\n    }\n\n    const { pluginKey = 'floatingMenu', tippyOptions = {}, shouldShow = null } = this.menuProps;\n    const plugin = FloatingMenuPlugin({\n      pluginKey,\n      editor: this.editor,\n      element: this.element,\n      tippyOptions: {\n        placement: 'left',\n        getReferenceClientRect: () => {\n          const anchor = this.editor.view.state.selection.$anchor;\n          const pos = anchor.pos - anchor.parentOffset;\n          return posToDOMRect(this.editor.view, pos, pos);\n        },\n        ...tippyOptions,\n      },\n      shouldShow:\n        shouldShow ??\n        (({ view, state }) => {\n          const { selection } = state;\n          const { $anchor, empty } = selection;\n          const isRootDepth = $anchor.depth === 1;\n          return !(!view.hasFocus() || !empty || !isRootDepth);\n        }),\n    });\n    this.editor.registerPlugin(plugin);\n  }\n\n  render() {\n    const items = [\n      {\n        icon: 'ci-plus',\n        title: 'Add',\n        action: () => {},\n      },\n      {\n        icon: 'ci-more_vertical',\n        title: 'Click to tune',\n        action: () => {},\n      },\n    ];\n    return (\n      <div ref={el => (this.element = el)} class=\"floating-menu\" style={{ visibility: 'hidden' }}>\n        {items.map((item, index) => {\n          const { isHidden, type, ...rest } = item as any;\n          if (isHidden && isHidden()) {\n            return;\n          }\n          return type === 'divider' ? <div class=\"divider\" key={index} /> : <tiptap-menu-item itemProps={{ ...rest }} key={index} />;\n        })}\n      </div>\n    );\n  }\n}\n"],"mappings":"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"}